---


- name: Ubuntu - Add jenkins user to sudo
  user:
    name: jenkins
    group: sudo
    shell: /bin/bash



- name: enable passwordless sudo
  lineinfile:
    path: /etc/sudoers
    state: present
    regexp: '^%sudo'
    line: '%sudo ALL=(ALL) NOPASSWD: ALL'
  tags:
   - agent_sudo



- name: "Build hosts file - ONLY NEEDED FOR TEST ENVIRONMENTS"
  lineinfile:
    dest: /etc/hosts
    line: "{% for host in groups['jenkins-master'] %}{{  hostvars[host].ansible_host }} {{host}} {% endfor %}"
    state: present
  tags:
   - agent_hosts_file


- name: rm aptly locks
  file:
    name: /var/lib/dpkg/lock
    state: absent
  tags:
   - agent_aptly
   - agent_git

- name: install git
  apt:
    name: git
    update_cache: yes
    state: present
  tags:
   - agent_git